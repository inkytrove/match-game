<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØ®Ù…ÙŠÙ†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Ù…ÙƒØªØ¨Ø© Socket.IO -->
  <script src="/socket.io/socket.io.js"></script>

  <!-- Ø¬Ù„Ø¨ Ø®Ø·Ù‘ "Tajawal" Ø§Ù„Ø¹Ø±ÙŠØ¶ -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      user-select: none;
    }
    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #1b5e20, #004d40);
      color: #fff;
      padding: 10px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      text-align: center;
      width: 100%;
      margin-bottom: 12px;
    }
    header h1 {
      font-size: 2.4rem;
      margin-bottom: 6px;
    }
    #roomDisplay {
      font-size: 1rem;
      color: #c5e1a5;
      margin-bottom: 4px;
    }
    #teamName {
      font-size: 1.4rem;
      margin-bottom: 8px;
      font-weight: 700;
    }
    #roundName {
      font-size: 1.2rem;
      margin-bottom: 12px;
      font-weight: 700;
    }
    .instructions {
      font-size: 1rem;
      margin-bottom: 16px;
    }

    /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† + Ù†Ù‚Ø§Ø·Ù‡Ù… */
    #playersScores {
      margin-bottom: 12px;
      width: 100%;
      max-width: 360px;
      list-style: none;
      padding: 0;
    }
    #playersScores li {
      font-size: 1rem;
      margin-bottom: 4px;
      color: #c5e1a5;
    }

    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø¯Ø¡ ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯ */
    .controls {
      display: flex;
      gap: 10px;
      width: 100%;
      max-width: 360px;
      margin-bottom: 16px;
    }
    .controls button {
      flex: 1;
      padding: 10px;
      font-size: 1rem;
      background: #38a169;
      border: none;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
      font-weight: 700;
      transition: background 0.2s, transform 0.1s;
    }
    .controls button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    .controls button:hover:not(:disabled) {
      background: #2f855a;
    }
    .controls button:active:not(:disabled) {
      transform: scale(0.98);
    }

    /* Ù„ÙˆØ­Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ø£ØµÙ„ÙŠØ© */
    #board {
      display: flex;
      justify-content: space-between;
      gap: 4px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ© Ø¨ÙŠÙ† Ø§Ù„Ø®Ø§Ù†Ø§Øª */
      width: 100%;
      max-width: 360px;
      margin-bottom: 8px; /* Ù…Ø³Ø§ÙØ© Ø¨Ø³ÙŠØ·Ø© Ù‚Ø¨Ù„ Ù„ÙˆØ­ Ø§Ù„ØªØ®Ù…ÙŠÙ† */
    }
    /* Ù„ÙˆØ­Ø© Ø£Ù…Ø§ÙƒÙ† Ø§Ù„ØªØ®Ù…ÙŠÙ† */
    #slots {
      display: flex;
      justify-content: space-between;
      gap: 4px;
      width: 100%;
      max-width: 360px;
      margin-bottom: 16px;
    }
    .slot {
      width: calc((100% - 5 * 4px) / 6);
      aspect-ratio: 1;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid #a5d6a7; /* Ø¥Ø·Ø§Ø± ØµÙ„Ø¨ */
      border-radius: 4px;
      position: relative;
    }
    .slot img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 4px;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    /* ØªØºØ°ÙŠØ© Ø±Ø§Ø¬Ø¹Ø© (Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©) */
    #feedback {
      font-size: 1rem;
      margin-bottom: 12px;
      text-align: center;
      visibility: hidden;
      font-weight: 700;
    }

    /* Ø¹Ø±Ø¶ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© */
    #correctAnswer {
      display: none;
      margin-top: 16px;
      width: 100%;
      max-width: 360px;
    }
    #correctAnswer .label {
      font-size: 1rem;
      margin-bottom: 8px;
      text-align: center;
      color: #c5e1a5;
      font-weight: 700;
    }
    #correctAnswer .grid {
      display: flex;
      justify-content: space-between;
      gap: 4px;
      width: 100%;
      max-width: 360px;
      margin-bottom: 16px;
    }
    #correctAnswer .grid .slot {
      width: calc((100% - 5 * 4px) / 6);
      background: rgba(255,255,255,0.1);
      border: none;
    }
    #correctAnswer .grid .slot img {
      border: 2px solid #a5d6a7;
    }

    /* ØªÙƒÙŠÙ‘Ù Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    @media (max-width: 320px) {
      body {
        padding: 5px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
      }
      #board, #slots, #correctAnswer .grid {
        gap: 2px; /* ÙØ±Ø§Øº Ø£ØµØºØ± Ø¨ÙŠÙ† Ø§Ù„Ø®Ø§Ù†Ø§Øª */
      }
      .slot {
        width: calc((100% - 5 * 2px) / 6);
      }
      #playersScores li {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØ®Ù…ÙŠÙ†</h1>
    <div id="roomDisplay">Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©: â€”</div>
    <div id="teamName">ÙØ±ÙŠÙ‚</div>
    <div id="roundName">Ø§Ù„Ø¬ÙˆÙ„Ø©: â€”</div>
    <div class="instructions">Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ± Ø£Ùˆ Ø¨Ø¯Ù‘Ù„ Ø¨ÙŠÙ†Ù‡Ø§ Ø«Ù… Ø§Ø¶ØºØ· "ØªØ£ÙƒÙŠØ¯"</div>
  </header>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† + Ù†Ù‚Ø§Ø·Ù‡Ù… -->
  <ul id="playersScores"></ul>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø¯Ø¡ ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯ -->
  <div class="controls">
    <button id="startBtn">Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©</button>
    <button id="submit" disabled>ØªØ£ÙƒÙŠØ¯</button>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ø£ØµÙ„ÙŠØ© (Ù¦ ØµÙˆØ± Ø£ÙÙ‚ÙŠÙ‹Ø§) -->
  <div id="board"></div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ®Ù…ÙŠÙ† (Ù¦ Ø®Ø§Ù†Ø§Øª Ø£ÙÙ‚ÙŠÙ‹Ø§) -->
  <div id="slots"></div>

  <!-- ØªØºØ°ÙŠØ© Ø±Ø§Ø¬Ø¹Ø© Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© -->
  <div id="feedback">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©: 0 Ù…Ù† 0</div>

  <!-- Ø¹Ø±Ø¶ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ø¹Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬ÙˆÙ„Ø© (Ù¦ ØµÙˆØ±) -->
  <div id="correctAnswer">
    <div class="label">Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­:</div>
    <div class="grid" id="answerGrid"></div>
  </div>

  <script>
    // Ù…Ù†Ø¹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù‚Ø± Ø§Ù„ÙŠÙ…Ù†Ù‰ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±
    document.body.addEventListener('contextmenu', e => {
      if (e.target.tagName === 'IMG') e.preventDefault();
    });

    const socket = io();

    // Ù‚Ø±Ø§Ø¡Ø© room Ùˆ name Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©
    const params   = new URLSearchParams(location.search);
    const roomId   = params.get('room') || 'eid-room';
    let playerName = params.get('name') || prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ');
    playerName     = decodeURIComponent(playerName);

    // Ù…Ø±Ø§Ø¬Ø¹ DOM
    const roomDisplay   = document.getElementById('roomDisplay');
    const playersScores = document.getElementById('playersScores');
    const teamEl        = document.getElementById('teamName');
    const roundEl       = document.getElementById('roundName');
    const startBtn      = document.getElementById('startBtn');
    const submitBtn     = document.getElementById('submit');
    const boardEl       = document.getElementById('board');
    const slotsEl       = document.getElementById('slots');
    const fb            = document.getElementById('feedback');
    const correctAnswer = document.getElementById('correctAnswer');
    const answerGrid    = document.getElementById('answerGrid');

    let items = [], draggedImg = null;

    // Ø¹Ø±Ø¶ Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ© ÙˆØ§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
    roomDisplay.textContent = `Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©: ${roomId}`;
    teamEl.textContent      = playerName;

    // Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©
    socket.emit('joinRoom', { roomId, playerName });

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© (Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† + Ø§Ù„Ù†Ù‚Ø§Ø·)
    socket.on('stateMulti', ({ scores: sc, players }) => {
      playersScores.innerHTML = '';
      players.forEach(p => {
        const li = document.createElement('li');
        const pts = sc[p.name] || 0;
        li.textContent = `${p.name}: ${pts} Ù†Ù‚Ø·Ø©`;
        playersScores.appendChild(li);
      });
    });

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø·Ø£ Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø¨Ø¯ÙˆÙ† Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙƒØ§ÙÙŠÙŠÙ†
    socket.on('errorMulti', ({ message }) => {
      alert(message);
    });

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©"
    startBtn.addEventListener('click', () => {
      socket.emit('startRound', { roomId });
      startBtn.disabled = true;
    });

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬ÙˆÙ„Ø©
    socket.on('roundStartedMulti', ({ items: newItems, roundName: cat, scores: sc, currentRound, players }) => {
      items = newItems;
      // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬ÙˆÙ„Ø©
      roundEl.textContent = `Ø§Ù„Ø¬ÙˆÙ„Ø© ${currentRound}: ${translateCategory(cat)}`;
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·
      playersScores.innerHTML = '';
      players.forEach(p => {
        const li = document.createElement('li');
        const pts = sc[p.name] || 0;
        li.textContent = `${p.name}: ${pts} Ù†Ù‚Ø·Ø©`;
        playersScores.appendChild(li);
      });

      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø©
      fb.style.visibility = 'visible';
      fb.textContent = `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©: 0 Ù…Ù† ${items.length}`;
      submitBtn.disabled = false;

      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ù† ÙˆÙØ¬Ø¯
      correctAnswer.style.display = 'none';
      answerGrid.innerHTML = '';

      // Ø¨Ù†Ø§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ø£ØµÙ„ÙŠØ© (Ù¦ ØµÙˆØ±)
      boardEl.innerHTML = '';
      items.forEach(src => {
        const slot = document.createElement('div');
        slot.className = 'slot';
        slot.addEventListener('dragover', e => e.preventDefault());
        slot.addEventListener('drop', dropOnBoard);

        const img = document.createElement('img');
        img.src = src;
        img.draggable = true;
        img.addEventListener('dragstart', e => {
          draggedImg = e.target;
          e.dataTransfer.setData('text/plain', src);
          e.dataTransfer.setData('from', 'board');
        });

        slot.appendChild(img);
        boardEl.appendChild(slot);
      });

      // Ø¨Ù†Ø§Ø¡ Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„ØªØ®Ù…ÙŠÙ† Ø§Ù„ÙØ§Ø±ØºØ© (Ù¦ Ø®Ø§Ù†Ø§Øª)
      slotsEl.innerHTML = '';
      items.forEach(() => {
        const slot = document.createElement('div');
        slot.className = 'slot';
        slot.addEventListener('dragover', e => e.preventDefault());
        slot.addEventListener('drop', dropOnSlot);
        slotsEl.appendChild(slot);
      });
    });

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ£ÙƒÙŠØ¯"
    submitBtn.addEventListener('click', () => {
      const order = Array.from(slotsEl.children).map(s => {
        const img = s.querySelector('img');
        return img ? img.getAttribute('src').replace(location.origin, '') : null;
      });
      socket.emit('submitOrder', {
        roomId,
        playerId: playerName,
        order
      });
      // Ù„Ø§ Ù†Ø¹Ø·Ù‘Ù„ Ø§Ù„Ø²Ø±Ø› ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¶ØºØ· Ù…Ø¬Ø¯Ø¯Ù‹Ø§ Ø­ØªÙ‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­
    });

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØªØºØ°ÙŠØ© Ø±Ø§Ø¬Ø¹Ø© Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
    socket.on('feedbackMulti', ({ player, correctCount, total }) => {
      if (player === playerName) {
        fb.textContent = `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©: ${correctCount} Ù…Ù† ${total}`;
      }
    });

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¬ÙˆÙ„Ø© (ÙÙˆØ²/Ø®Ø³Ø§Ø±Ø© + Ø¹Ø±Ø¶ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­)
    socket.on('roundWinMulti', ({ scores: sc, winners, roundNumber, answer }) => {
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·
      playersScores.innerHTML = '';
      Object.entries(sc).forEach(([name, pts]) => {
        const li = document.createElement('li');
        li.textContent = `${name}: ${pts} Ù†Ù‚Ø·Ø©`;
        playersScores.appendChild(li);
      });

      // Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙÙˆØ²/Ø§Ù„Ø®Ø³Ø§Ø±Ø©
      if (winners.includes(playerName)) {
        fb.textContent = `ğŸ‰ Ù„Ù‚Ø¯ ÙØ²Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©!`;
      } else {
        fb.textContent = `ğŸ˜¢ Ø®Ø³Ø±Øª Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©!`;
      }

      // Ø¹Ø±Ø¶ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­ (Ù¦ ØµÙˆØ±)
      answerGrid.innerHTML = '';
      answer.forEach(src => {
        const slot = document.createElement('div');
        slot.className = 'slot';
        const img = document.createElement('img');
        img.src = src;
        img.draggable = false;
        slot.appendChild(img);
        answerGrid.appendChild(slot);
      });
      correctAnswer.style.display = 'block';

      // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± "ØªØ£ÙƒÙŠØ¯" Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©
      submitBtn.disabled = true;
    });

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø´Ø§Ø±Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
    socket.on('enableStartNext', () => {
      startBtn.disabled   = false;
      startBtn.textContent = 'Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©';
    });

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    socket.on('finalGameEndMulti', ({ scores: sc, finalWinners }) => {
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
      playersScores.innerHTML = '';
      Object.entries(sc).forEach(([name, pts]) => {
        const li = document.createElement('li');
        li.textContent = `${name}: ${pts} Ù†Ù‚Ø·Ø©`;
        playersScores.appendChild(li);
      });

      // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Overlay Ù„Ù„ØªÙ‡Ù†Ø¦Ø© Ø£Ùˆ Ø§Ù„ØªØ¹Ø§Ø¯Ù„
      const overlay = document.createElement('div');
      overlay.style.position = 'fixed';
      overlay.style.top = '0';
      overlay.style.left = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.background = 'rgba(0,0,0,0.8)';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.justifyContent = 'center';
      overlay.style.alignItems = 'center';
      overlay.style.color = '#fff';
      overlay.style.fontSize = '2rem';
      overlay.style.zIndex = '999';
      overlay.style.textAlign = 'center';
      overlay.style.padding = '20px';

      let message = '';
      if (finalWinners.includes(playerName)) {
        message = 'ğŸ‰ Ø£Ù„Ù Ù…Ø¨Ø±ÙˆÙƒ! Ø£Ù†Øª Ø§Ù„ÙØ§Ø¦Ø²!';
      } else if (finalWinners.length === 1 && !finalWinners.includes(playerName)) {
        message = 'ğŸ˜¢ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©. ÙØ§Ø² Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø±.';
      } else {
        message = 'âš–ï¸ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨ØªØ¹Ø§Ø¯Ù„ Ø¨ÙŠÙ†:\n' + finalWinners.join(' Ùˆ ');
      }
      const lines = message.split('\n');
      lines.forEach((ln, idx) => {
        const p = document.createElement('div');
        p.textContent = ln;
        if (idx === 0) p.style.marginBottom = '12px';
        overlay.appendChild(p);
      });

      document.body.appendChild(overlay);

      // Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø®Ø§Ø¯Ù…
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 5000);
    });

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¥Ø³Ù‚Ø§Ø· ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„ØªØ®Ù…ÙŠÙ† (dropOnSlot)
    function dropOnSlot(e) {
      e.preventDefault();
      const from = e.dataTransfer.getData('from');
      const url  = e.dataTransfer.getData('text/plain');

      // Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù…ÙƒØ§Ù† Ø§Ù„ØªØ®Ù…ÙŠÙ†
      if (from === 'board') {
        if (e.currentTarget.querySelector('img')) return;
        const orig = boardEl.querySelector(`img[src="${url}"]`);
        if (orig) orig.remove();
        const img = document.createElement('img');
        img.src = url;
        img.draggable = true;
        img.addEventListener('dragstart', ev => {
          draggedImg = ev.target;
          ev.dataTransfer.setData('text/plain', url);
          ev.dataTransfer.setData('from', 'slot');
        });
        e.currentTarget.appendChild(img);
      }
      // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø®Ø§Ù†Ø§Øª Ø§Ù„ØªØ®Ù…ÙŠÙ†
      else if (from === 'slot') {
        if (!draggedImg) return;
        if (!e.currentTarget.querySelector('img')) {
          const parentOfDragged = draggedImg.parentElement;
          parentOfDragged.removeChild(draggedImg);
          e.currentTarget.appendChild(draggedImg);
        } else {
          const targetImg = e.currentTarget.querySelector('img');
          const tempSrc = targetImg.src;
          targetImg.src = draggedImg.src;
          draggedImg.src = tempSrc;
        }
      }
    }

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¥Ø³Ù‚Ø§Ø· Ù„Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (dropOnBoard)
    function dropOnBoard(e) {
      e.preventDefault();
      if (e.dataTransfer.getData('from') !== 'slot') return;
      if (e.currentTarget.querySelector('img')) return;
      if (draggedImg) {
        const parentOfDragged = draggedImg.parentElement;
        parentOfDragged.removeChild(draggedImg);
        e.currentTarget.appendChild(draggedImg);
      }
    }

    // ØªØ±Ø¬Ù…Ø© Ø§Ø³Ù… Ø§Ù„ØªØµÙ†ÙŠÙ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠ
    function translateCategory(cat) {
      const catNames = {
        fruits:  'Ø§Ù„ÙÙˆØ§ÙƒÙ‡',
        drinks:  'Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª',
        tools:   'Ø§Ù„Ø£Ø¯ÙˆØ§Øª',
        veggies: 'Ø§Ù„Ø®Ø¶Ø±ÙˆØ§Øª',
        animals: 'Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª'
      };
      return catNames[cat] || cat;
    }
  </script>
</body>
</html>
